[Unit]
Description=CAdvisor Container
After=docker.service
Requires=docker.service

[Service]
TimeoutStartSec=0
Restart=always
ExecStartPre=-/usr/bin/docker stop cadvisor
ExecStartPre=-/usr/bin/docker rm cadvisor
ExecStartPre=/usr/bin/docker pull "{{ cadvisor_image }}"
ExecStart=/usr/bin/docker run --rm --name cadvisor -p {{ container_port }}:8080 -v "/:/rootfs:ro" -v "/var/run:/var/run:rw" -v "/sys/fs/cgroup/cpuacct:/sys/fs/cgroup/cpuacct:ro" -v "/sys/fs/cgroup/memory:/sys/fs/cgroup/memory:ro" -v "/var/lib/docker/:/var/lib/docker:ro" "{{ cadvisor_image }}"

[Install]
WantedBy=multi-user.target